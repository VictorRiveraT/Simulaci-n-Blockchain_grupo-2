<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Blockchain Simulator ‚Äî ECDSA & PoW</title>
  <style>
    :root { --bg:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#9ca3af; --accent:#22c55e; --danger:#ef4444; --border:#1f2937; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial; background: var(--bg); color: var(--text); }
    header { padding: 24px; border-bottom:1px solid var(--border); position: sticky; top:0; background: linear-gradient(180deg, #0f172a 0%, rgba(15,23,42,.9) 100%); backdrop-filter: blur(6px); }
    h1 { margin:0; font-size: 20px; }
    main { max-width: 1400px; margin: 24px auto; padding: 0 16px 48px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
    .col-span-2 { grid-column: span 2; }
    .col-span-3 { grid-column: span 3; }
    .card { background: var(--card); border:1px solid var(--border); border-radius: 14px; padding: 16px; }
    .card h2 { margin:0 0 10px 0; font-size: 18px; }
    label { font-size: 12px; color: var(--muted); display:block; margin-bottom:6px; }
    input, textarea { width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--border); background:#0b1220; color:var(--text); font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace; font-size: 12px; }
    .row { display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .btn { cursor:pointer; border:1px solid var(--border); background:#0b1220; color:var(--text); padding:10px 12px; border-radius:10px; transition: .15s ease; }
    .btn:hover { transform: translateY(-1px); border-color:#2b3447; }
    .btn.primary { border-color: #14532d; background:#0b1d12; }
    .btn.primary:hover { border-color:#16a34a; }
    .btn.danger { border-color:#3f1f25; background:#1a0b0d; }
    .muted { color: var(--muted); font-size: 12px; }
    pre { margin:0; white-space: pre-wrap; word-break: break-word; }
    code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace; font-size: 12px; }
    .log { background:#0b1220; border:1px dashed #273043; border-radius:12px; padding:12px; max-height: 460px; overflow:auto; }
    .badge { display:inline-block; font-size:11px; padding:2px 8px; border:1px solid #2b3447; border-radius:999px; color:#a3e2b5; background:#0b1d12; margin-left:8px; }
    .grid-4 { display:grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
    .grid-2 { display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .footer { text-align:center; color:var(--muted); font-size:12px; padding: 16px; border-top:1px solid var(--border); }
    .pill { display:inline-block; padding:2px 8px; border-radius:999px; font-size:11px; border:1px solid #2b3447; }
    .table { width: 100%; border-collapse: collapse; border:1px solid var(--border); background:#0b1220; border-radius: 12px; overflow: hidden; }
    .table th, .table td { padding:10px 12px; font-size:13px; border-bottom:1px solid #1e293b; word-break: break-all; }
    .table th { text-align:left; color:#93c5fd; background:#0a1222; }
    .table tr:hover td { background:#0c1527; }
    .kpi { display:flex; align-items:center; gap:10px; margin:6px 0 12px 0; color:var(--muted); }
    .validation-card.valid { border-color: var(--accent); animation: flashGreen 0.5s ease-out; }
    .validation-card.invalid { border-color: var(--danger); animation: flashRed 0.5s ease-out; }
    @keyframes flashGreen {
        0% { border-color: var(--border); }
        50% { border-color: var(--accent); }
        100% { border-color: var(--border); }
    }
    @keyframes flashRed {
        0% { border-color: var(--border); }
        50% { border-color: var(--danger); }
        100% { border-color: var(--border); }
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/elliptic/6.5.4/elliptic.min.js"></script>
  <script>
    const EC = elliptic.ec;
    const ec = new EC('secp256k1');

    let aliasCache = {}; 
    let reverseAliasCache = {}; 
    
    const stableStringify = (v) => {
      if (v === null || typeof v !== 'object') return JSON.stringify(v);
      if (Array.isArray(v)) return '[' + v.map(stableStringify).join(',') + ']';
      const keys = Object.keys(v).sort();
      return '{' + keys.map(k => JSON.stringify(k)+':'+stableStringify(v[k])).join(',') + '}';
    };

    const hashPayload = (payload) => {
        const payloadCopy = { ...payload };
        delete payloadCopy.signature;
        const s = stableStringify(payloadCopy);
        return sha256(s);
    };

    const generateKeyPair = () => {
        const key = ec.genKeyPair();
        const privateKeyHex = key.getPrivate('hex');
        const publicKeyHex = key.getPublic('hex'); 
        return { privateKeyHex, publicKeyHex };
    };

    const signTransaction = (privateKeyHex, payload) => {
        try {
            const key = ec.keyFromPrivate(privateKeyHex, 'hex');
            const payloadHash = hashPayload(payload);
            const signature = key.sign(payloadHash, 'hex');
            return signature.toDER('hex'); 
        } catch (e) {
            console.error("Error signing:", e);
            return "";
        }
    };
    
    const pubToAddress = (publicKeyHex) => {
        if (!publicKeyHex || publicKeyHex.length < 40) return publicKeyHex;
        if (publicKeyHex === 'SYSTEM' || publicKeyHex === '0000_GENESIS_0000') return publicKeyHex;
        
        const alias = reverseAliasCache[publicKeyHex];
        const shortKey = publicKeyHex.substring(0, 40) + '...';
        return alias ? `${alias} (${shortKey})` : shortKey;
    };

    const log = (obj, title) => {
      const el = document.getElementById('log');
      const prev = el.innerHTML;
      const now = `<pre><code>${title ? '‚ñ∂ ' + title + '\n' : ''}${typeof obj === 'string' ? obj : JSON.stringify(obj, null, 2)}</code></pre>`;
      el.innerHTML = now + '\n' + prev;
    };
    const setBadge = (ok, extra='') => {
      const b = document.getElementById('statusBadge');
      if (ok) { b.textContent = 'Status: OK ' + extra; b.style.color = '#86efac'; }
      else { b.textContent = 'Status: ERROR ' + extra; b.style.color = '#fca5a5'; }
    };
    const api = (path, opts={}) =>
      fetch(path, { headers: { 'Content-Type':'application/json' }, ...opts })
        .then(async r => {
          const data = await r.json().catch(()=>({raw:'(sin JSON)'}));
          if (!r.ok) throw { status: r.status, data };
          return data;
        });
        
    const updateAliasCaches = async () => {
        try {
            const data = await api('/aliases');
            aliasCache = data;
            reverseAliasCache = {}; 
            for (const [alias, pubkey] of Object.entries(data)) {
                reverseAliasCache[pubkey] = alias;
            }
            log(aliasCache, 'üìá Alias Sincronizados');
        } catch (e) {
            log(e, '‚ùå ERROR /aliases');
        }
    };
        
    const renderTable = (title, dataObj, containerId, valueLabel='Valor') => {
      const container = document.getElementById(containerId);
      const entries = Object.entries(dataObj || {});
      if (!entries.length) {
        container.innerHTML = `<div class="muted">Sin datos por ahora.</div>`;
        return;
      }
      const rows = entries
        .map(([k,v],i) => {
            const displayValue = Number(v); 
            const displayName = pubToAddress(k);
            return `
              <tr>
                <td style="width:56px;">#${i+1}</td>
                <td><code>${displayName}</code></td>
                <td style="text-align:right">${displayValue}</td>
              </tr>
            `;
        }).join('');
      container.innerHTML = `
        <div class="muted" style="margin:6px 0 8px 0;">${title}</div>
        <table class="table">
          <thead>
            <tr><th>#</th><th>Address (Alias / Public Key)</th><th style="text-align:right">${valueLabel}</th></tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      `;
    };

    const renderMempool = (transactions, containerId='mempoolResults') => {
      const container = document.getElementById(containerId);
      if (transactions.length === 0) {
        container.innerHTML = '<div class="muted">El Mempool est√° vac√≠o.</div>';
        return;
      }

      const rows = transactions.map((tx, i) => {
        const displayAmount = Number(tx.amount);
        const senderName = pubToAddress(tx.sender);
        const recipientName = pubToAddress(tx.recipient);
        const time = tx.timestamp ? new Date(tx.timestamp * 1000).toLocaleTimeString() : 'N/A';

        return `
            <tr>
                <td style="width: 30px;">#${i + 1}</td>
                <td style="width: 100px; text-align:right;">${displayAmount}</td>
                <td><code>${senderName}</code></td>
                <td><code>${recipientName}</code></td>
                <td>${time}</td>
            </tr>
        `;
      }).join('');

      container.innerHTML = `
            <table class="table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th style="text-align:right;">Monto</th>
                        <th>Remitente</th>
                        <th>Destinatario</th>
                        <th>Hora</th>
                    </tr>
                </thead>
                <tbody>${rows}</tbody>
            </table>
        `;
    };
    
    let lastVerifiedTransaction = null; 

    window.addEventListener('load', () => {
        
        document.getElementById('btnRandomKeys').onclick = async () => {
            const alias = document.getElementById('alias').value;
            if (!alias) {
                log("ERROR: Debes escribir un Alias (nombre) para registrar.", '‚ùå Error de Registro');
                return;
            }
            
            log("Generando llaves y registrando alias...");
            const { privateKeyHex, publicKeyHex } = generateKeyPair();
            if (!privateKeyHex || !publicKeyHex) { 
                log("ERROR: La generaci√≥n de claves fall√≥.", '‚ùå Error de Criptograf√≠a');
                return;
            }
            
            document.getElementById('privateKey').value = privateKeyHex;
            document.getElementById('publicKey').value = publicKeyHex;
            document.getElementById('sender_pub_tx').value = publicKeyHex; 
            document.getElementById('miner_address').value = publicKeyHex; 
            log({ alias, privateKeyHex, publicKeyHex }, 'üóùÔ∏è Llaves Generadas');
            
            try {
                const regData = await api('/register_alias', {
                    method: 'POST',
                    body: JSON.stringify({ alias: alias, public_key: publicKeyHex })
                });
                log(regData, '‚úÖ Alias Registrado');
                await updateAliasCaches();
                document.getElementById('btnBalances').click();
            } catch (e) {
                log(e.data, '‚ùå ERROR de Registro de Alias');
            }
            
            document.getElementById('signature_node').value = '';
            document.getElementById('publickey_node').value = '';
            document.getElementById('btnSendToMempool').disabled = true;
            document.getElementById('validationCard').classList.remove('valid', 'invalid');
            lastVerifiedTransaction = null;
        };

        document.getElementById('btnSignTx').onclick = () => {
            const privateKeyHex = document.getElementById('privateKey').value;
            const senderPub = document.getElementById('sender_pub_tx').value;
            let recipient = document.getElementById('recipient_tx').value;
            
            const amount_input = parseFloat(document.getElementById('amount_tx').value || '0');
            const amount_int = Math.round(amount_input); 

            if (!privateKeyHex || !senderPub) {
                log("ERROR: Debes generar y seleccionar las Llaves primero.", '‚ùå Error de Firma');
                return;
            }
            
            if (recipient && !recipient.startsWith('04')) {
                const resolvedKey = aliasCache[recipient];
                if (resolvedKey) {
                    log(`Alias "${recipient}" resuelto a ${resolvedKey.substring(0, 20)}...`);
                    recipient = resolvedKey;
                } else {
                    log(`ERROR: Alias "${recipient}" no encontrado.`, '‚ùå Error de Firma');
                    return;
                }
            }
            
            if (!recipient || amount_int <= 0) {
                log("ERROR: Monto debe ser positivo y Destinatario (o alias) v√°lido.", '‚ùå Error de Firma');
                return;
            }

            const payload = {
                amount: amount_int, 
                recipient: recipient, 
                sender: senderPub,
            };
            
            const signature = signTransaction(privateKeyHex, payload);
            document.getElementById('signature_tx').value = signature;
            log({ payload, signature, hash: hashPayload(payload) }, '‚úçÔ∏è Transacci√≥n Firmada');

            document.getElementById('signature_node').value = signature;
            document.getElementById('publickey_node').value = senderPub;
            document.getElementById('btnSendToMempool').disabled = true; 
            document.getElementById('validationCard').classList.remove('valid', 'invalid');
            lastVerifiedTransaction = null;
        };
        
        const validationCard = document.getElementById('validationCard');
        const btnSendToMempool = document.getElementById('btnSendToMempool');
        btnSendToMempool.disabled = true; 

        document.getElementById('btnVerifyTxNode').onclick = async () => {
            const sender_pub = document.getElementById('sender_pub_tx').value;
            let recipient = document.getElementById('recipient_tx').value;
            
            const amount_input = parseFloat(document.getElementById('amount_tx').value || '0');
            const amount_int = Math.round(amount_input);

            const signature = document.getElementById('signature_node').value;
            const publickey_for_verification = document.getElementById('publickey_node').value;

            if (recipient && !recipient.startsWith('04')) {
                const resolvedKey = aliasCache[recipient];
                if (resolvedKey) {
                    log(`Alias "${recipient}" resuelto a ${resolvedKey.substring(0, 20)}...`);
                    recipient = resolvedKey;
                } else {
                    log(`ERROR: Alias "${recipient}" no encontrado.`, '‚ùå Error de Verificaci√≥n');
                    validationCard.classList.add('invalid');
                    return;
                }
            }

            if (!sender_pub || !signature || !recipient || amount_int <= 0 || !publickey_for_verification) {
                log("ERROR: Rellenar todos los campos de Tx, Public Key y Firma.", '‚ùå Error de Verificaci√≥n');
                validationCard.classList.remove('valid');
                validationCard.classList.add('invalid');
                btnSendToMempool.disabled = true;
                return;
            }

            try {
                const verificationResult = await api('/transactions/verify_only', {
                    method: 'POST',
                    body: JSON.stringify({ 
                        sender_pub: publickey_for_verification, 
                        recipient: recipient,
                        amount: amount_int,
                        signature: signature,
                    })
                });

                if (verificationResult && verificationResult.valid) {
                    log("VERIFICACI√ìN EXITOSA (BACKEND): Firma v√°lida y fondos suficientes.", '‚úÖ Verificaci√≥n Exitosa');
                    validationCard.classList.remove('invalid');
                    validationCard.classList.add('valid');
                    btnSendToMempool.disabled = false;
                    lastVerifiedTransaction = { sender_pub: publickey_for_verification, recipient, amount: amount_int, signature: signature };

                } else {
                    log(verificationResult.error || "VERIFICACI√ìN FALLIDA: Fondos insuficientes o error en el backend.", '‚ùå Verificaci√≥n Fallida');
                    validationCard.classList.remove('valid');
                    validationCard.classList.add('invalid');
                    btnSendToMempool.disabled = true;
                }

            } catch (e) {
                log(e.data?.error || "VERIFICACI√ìN FALLIDA: Error al comunicarse con el nodo.", '‚ùå Verificaci√≥n Fallida');
                validationCard.classList.remove('valid');
                validationCard.classList.add('invalid');
                btnSendToMempool.disabled = true;
            }
        };

        document.getElementById('btnSendToMempool').onclick = async () => {
            if (!lastVerifiedTransaction) {
                log("ERROR: Primero debes verificar la transacci√≥n.", '‚ùå Error de Env√≠o');
                return;
            }
            
            try { 
                const d = await api('/transactions/new', { 
                    method:'POST', 
                    body: JSON.stringify(lastVerifiedTransaction) 
                }); 
                log(d, '‚úÖ Transacci√≥n A√±adida al Mempool');
                document.getElementById('btnShowMempool').click();
                document.getElementById('btnBalances').click();
                
                btnSendToMempool.disabled = true;
                validationCard.classList.remove('valid', 'invalid');
                lastVerifiedTransaction = null;

            } catch (e) { 
                log(e, '‚ùå ERROR al enviar al Mempool'); 
                document.getElementById('btnBalances').click();
            }
        };

        document.getElementById('btnMine').onclick = async () => {
            const miner_address = document.getElementById('miner_address').value;
            if (!miner_address) {
                log("ERROR: La direcci√≥n del minero no puede estar vac√≠a.", '‚ùå Error de Minado');
                return;
            }
            const t0 = performance.now();
            try { 
                const d = await api('/mine', { method:'POST', body: JSON.stringify({ miner_address }) }); 
                const t1 = performance.now(); 
                log({ tiempo_ms: Math.round(t1-t0), ...d }, '‚õèÔ∏è Bloque Minado'); 

                document.getElementById('blockIndex').textContent = d.index;
                document.getElementById('blockNonce').textContent = d.nonce;
                document.getElementById('blockPrevHash').textContent = d.previous_hash;
                document.getElementById('blockHash').textContent = d.hash;

                const txListEl = document.getElementById('blockTxsList');
                if (d.transactions && d.transactions.length > 0) {
                    txListEl.innerHTML = d.transactions.map((tx, i) => 
                        `<p class="muted" style="font-size:11px; margin: 4px 0;">
                            <b>Tx #${i}:</b> ${tx.amount} 
                            (De: ${pubToAddress(tx.sender)} 
                            -> A: ${pubToAddress(tx.recipient)})
                        </p>`
                    ).join('');
                } else {
                    txListEl.innerHTML = '<p class="muted">No hay transacciones en este bloque.</p>';
                }

                document.getElementById('btnChain').click();
                document.getElementById('btnLeaders').click();
                document.getElementById('btnBalances').click();
                document.getElementById('btnShowMempool').click(); 

            } catch (e) { 
                log(e, '‚ùå ERROR /mine'); 
            }
        };

        document.getElementById('btnHealth').onclick = async () => {
          try { const d = await api('/health'); setBadge(true, `(diff=${d.difficulty})`); log(d, '/health'); }
          catch (e) { setBadge(false); log(e, '‚ùå ERROR /health'); }
        };
        document.getElementById('btnChain').onclick = async () => { try { log(await api('/chain'), 'üîó /chain'); } catch(e){ log(e,'‚ùå ERROR /chain'); } };
        document.getElementById('btnValidate').onclick = async () => { try { log(await api('/validate'), 'üõ°Ô∏è /validate'); } catch(e){ log(e,'‚ùå ERROR /validate'); } };
        
        document.getElementById('btnLeaders').onclick = async () => {
          try { 
            await updateAliasCaches();
            const d = await api('/leaders');
            log(d, 'üëë /leaders (Ranking)');                 
            renderTable('Recompensas acumuladas por minero', d, 'leadersTable', 'Recompensa');
          } catch (e) { log(e, '‚ùå ERROR /leaders'); }
        };
        document.getElementById('btnBalances').onclick = async () => {
          try { 
            await updateAliasCaches();
            const d = await api('/balances');
            log(d, 'üí∞ /balances (Saldos)');
            renderTable('Saldo neto por address (Public Key)', d, 'balancesTable', 'Saldo');
          } catch (e) { log(e, '‚ùå ERROR /balances'); }
        };
        document.getElementById('btnShowMempool').onclick = async () => { 
            try { 
                await updateAliasCaches();
                const d = await api('/mempool'); 
                renderMempool(d, 'mempoolResults'); 
                log(d, 'üìù /mempool (Transacciones Pendientes)'); 
            } catch(e) { log(e,'‚ùå ERROR /mempool'); } 
        };

        document.getElementById('btn_faucet_send').onclick = async () => {
            const recipient = document.getElementById('faucet_recipient').value;
            const private_key = document.getElementById('faucet_private_key').value;
            let recipient_address = recipient;

            if (!recipient_address || !private_key) {
                log("ERROR: Debes poner un Destinatario Y la Llave Privada del Fundador.", '‚ùå Error de Faucet');
                return;
            }

            if (!recipient_address.startsWith('04')) {
                const resolvedKey = aliasCache[recipient_address];
                if (resolvedKey) {
                    log(`Alias "${recipient_address}" resuelto a ${resolvedKey.substring(0, 20)}...`);
                    recipient_address = resolvedKey;
                } else {
                    log(`ERROR: Alias "${recipient_address}" no encontrado.`, '‚ùå Error de Faucet');
                    return;
                }
            }
            
            log(`Enviando 100 monedas del Faucet a ${pubToAddress(recipient_address)}...`);
            try {
                const d = await api('/faucet', { 
                    method:'POST', 
                    body: JSON.stringify({ 
                        recipient_address: recipient_address,
                        admin_private_key: private_key
                    }) 
                });
                log(d, 'üíß Faucet');
                document.getElementById('btnShowMempool').click();
                document.getElementById('btnBalances').click();
            } catch (e) {
                log(e.data, '‚ùå ERROR /faucet');
            }
        };

        const init = async () => {
            await updateAliasCaches();
            document.getElementById('btnHealth').click();
            document.getElementById('btnBalances').click();
        };
        init();
    });
  </script>
</head>
<body>
  <header>
    <h1>Simulador Blockchain üîê ECDSA + PoW <span class="badge" id="statusBadge">Status: ...</span></h1>
    <div class="muted">El c√≥digo fuente ha sido modificado para usar Llaves P√∫blicas como direcciones y verificar Firmas y Fondos.</div>
  </header>

  <main>
    <section class="card">
      <h2>1. üóùÔ∏è Generaci√≥n de Identidad (Usuario)</h2>
      
      <label>Alias (Tu nombre de usuario)</label>
      <input id="alias" placeholder="Ej: victor, satoshi, ..." />
      <div style="height:10px"></div>
      
      <label>Llave Privada (Private Key - ¬°Secreta!)</label>
      <input id="privateKey" placeholder="Se generar√° al registrar el alias..." readonly/>
      <div style="height:10px"></div>
      <label>Llave P√∫blica (Public Key - Direcci√≥n)</label>
      <textarea id="publicKey" rows="3" placeholder="Se generar√° al registrar el alias..." readonly></textarea>
      <div style="height:10px"></div>
      
      <button class="btn primary" id="btnRandomKeys">GENERAR Y REGISTRAR ALIAS</button>
      
    </section>

    <section class="card">
      <h2>2. ‚úçÔ∏è Creaci√≥n y Firma de Transacci√≥n (Remitente)</h2>
      <label>Remitente (sender_pub - Copia la Public Key de arriba)</label>
      <textarea id="sender_pub_tx" rows="2" placeholder="Llave P√∫blica COMPLETA del remitente (FROM)"></textarea>
      <div style="height:10px"></div>
      
      <label>Destinatario (recipient)</label>
      <input id="recipient_tx" placeholder="Alias o Llave P√∫blica de otro usuario (TO)" value="04634f590b074a123f81e3630f146a066c06173a144e54e4c9c221191060934e6284f1b4a558509c2a8c3d706f9d34346747530e7d0263f10646c8a513511111" />
      <div style="height:10px"></div>
      
      <label>Monto (amount)</label>
      <input id="amount_tx" type="number" step="1" placeholder="10" value="10" /> 
      
      <div style="height:10px"></div>
      <button class="btn" id="btnSignTx">SIGN (Firmar con Private Key)</button>
      <div style="height:10px"></div>
      <label>Firma de Transacci√≥n (Message Signature)</label>
      <textarea id="signature_tx" rows="2" placeholder="Se genera al firmar el payload..."></textarea>
    </section>

    <section class="card validation-card" id="validationCard">
      <h2>3. üõ°Ô∏è Nodo Central: Verificaci√≥n de Firma y Fondos</h2>
      <div class="muted">
        El Nodo Central verifica la autenticidad (firma) y la disponibilidad de fondos antes de aceptar una transacci√≥n.
      </div>
      <div style="height:16px"></div>

      <label>Firma del Mensaje (Message Signature)</label>
      <textarea id="signature_node" rows="2" placeholder="Copia la firma de la secci√≥n 2"></textarea>
      <div style="height:10px"></div>
      <label>Llave P√∫blica del Remitente (Public Key)</label>
      <textarea id="publickey_node" rows="2" placeholder="Copia la Public Key del Remitente de la secci√≥n 2"></textarea>
      <div style="height:10px"></div>

      <div class="row">
          <button class="btn" id="btnVerifyTxNode">VERIFY</button>
          <button class="btn primary" id="btnSendToMempool">SEND al Mempool</button>
      </div>
    </section>
    
    <div class="card col-span-3" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; padding: 16px;">
        
        <div class="card" style="margin: 0; padding: 0;">
            <h2>4. üìù Mempool (Transacciones Pendientes)</h2>
            <div class="muted" style="margin-bottom: 10px;">
                Transacciones v√°lidas esperando ser incluidas en el pr√≥ximo bloque por un minero.
            </div>
            <button class="btn" id="btnShowMempool">Ver Mempool Actual</button>
            <div style="margin-top: 15px;">
                <div id="mempoolResults">
                    <div class="muted">Haz clic en "Ver Mempool Actual" para ver transacciones pendientes.</div>
                </div>
            </div>
        </div>

        <div class="card" style="margin: 0; padding: 0;">
            <h2>5. ‚õèÔ∏è Proceso de Minado (Nodo)</h2>
            <label>Direcci√≥n del minero (Alias o Public Key)</label>
            <textarea id="miner_address" rows="2" placeholder="Pega aqu√≠ tu Alias o Public Key para recibir la recompensa..."></textarea>
            <div style="height:10px"></div>
            <button class="btn primary" id="btnMine">MINAR Bloque (PoW)</button>
            <div style="height:20px"></div>

            <h3>Bloque Candidato (Resultado)</h3>
            <div class="muted">
                Haz clic en MINAR para calcular el hash del siguiente bloque.
            </div>
            
            <div id="blockCandidateDisplay" class="card" style="margin-top:10px; border:1px solid #475569; background:#0b1d22; padding: 10px;">
                <p><strong>Bloque N¬∞:</strong> <span id="blockIndex">...</span></p>
                <p><strong>Nonce encontrado:</strong> <span id="blockNonce">...</span></p>
                <p><strong>Prev Hash:</strong> <code id="blockPrevHash">...</code></p>
                <hr style="border-color:#475569;">
                <h4>Transacciones (Mempool incluido):</h4>
                <div id="blockTxsList">
                    <p class="muted">Carga el Mempool para ver el contenido a minar.</p>
                </div>
                <hr style="border-color:#475569;">
                <p><strong>HASH V√ÅLIDO:</strong> <code id="blockHash">...</code></p>
            </div>
        </div>
    </div>

    <section class="card col-span-3">
      <h2>6. Resumen Econ√≥mico (Validado por la Cadena)</h2>
      <div class="row">
        <div><div id="leadersTable"></div></div>
        <div><div id="balancesTable"></div></div>
      </div>
    </section>
    
    <section class="card col-span-3">
      <h2>7. Panel de Resultados / Log</h2>
      <div class="log" id="log"></div>
    </section>

    <section class="card col-span-3">
        <h2>üéÅ Faucet del Fundador (Admin)</h2>
        <div class="muted">
          Aqu√≠ el Fundador puede "empujar" fondos a cualquier usuario.
          (Necesitas la Llave Privada del Fundador que se muestra en la consola del servidor).
        </div>
        <div style="height:16px"></div>
  
        <label>Destinatario (Alias o Llave P√∫blica)</label>
        <input id="faucet_recipient" placeholder="Ej: victor (o la llave 04...)" />
        <div style="height:10px"></div>

        <label>Llave Privada del Fundador (Admin)</label>
        <textarea id="faucet_private_key" rows="2" placeholder="Copiar de la consola del servidor..."></textarea>
        <div style="height:10px"></div>
        
        <button class="btn" id="btn_faucet_send" style="background-color: #3b0764; border-color: #a855f7;">
            ENVIAR 100 (desde Fundador)
        </button>
    </section>

    <section class="card col-span-3">
      <h2>8. Consultas de Cadena</h2>
      <div class="grid-4">
        <button class="btn" id="btnHealth">/health</button>
        <button class="btn" id="btnChain">/chain</button>
        <button class="btn" id="btnValidate">/validate</button>
        <button class="btn" id="btnLeaders">/leaders</button>
        <button class="btn" id="btnBalances">/balances</button>
        <span></span>
        <span></span>
        <span></span>
      </div>
    </section>
  </main>

  <div class="footer">Este simulador requiere las librer√≠as Flask, ecdsa, y js-sha256/elliptic en el frontend.</div>
</body>
</html>
